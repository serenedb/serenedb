hash-threshold 1337


statement ok
CREATE TABLE tindex
(
  id INTEGER PRIMARY KEY,
  name TEXT
);


statement ok
CREATE TABLE clickclack
(
  id INTEGER PRIMARY KEY,
  name TEXT
);


statement count 3
INSERT INTO tindex VALUES (1, 'vedernikoff'), (2, 'pavelvi'), (3, 'babsky');


statement count 3
COPY tindex TO '/tmp/quit_low_salary.csv';


statement count 3
COPY clickclack FROM '/tmp/quit_low_salary.csv';


query
SELECT * FROM clickclack ORDER BY 1, 2;
----
id	name
1	vedernikoff
2	pavelvi
3	babsky


statement count 3
DELETE FROM clickclack;


statement count 2
COPY clickclack FROM '/tmp/quit_low_salary.csv' WHERE id != 2;


query
SELECT * FROM clickclack ORDER BY 1, 2;
----
id	name
1	vedernikoff
3	babsky


statement count 2
DELETE FROM clickclack;


statement count 1
COPY (SELECT * FROM tindex ORDER BY 1 DESC LIMIT 1) TO '/tmp/quit_low_salary.csv';


statement count 1
COPY clickclack FROM '/tmp/quit_low_salary.csv';


query
SELECT * FROM clickclack;
----
id	name
3	babsky


statement count 1
DELETE FROM clickclack;


statement ok
CREATE TABLE reversed
(
  name TEXT PRIMARY KEY,
  id INTEGER
);


statement count 3
COPY tindex TO '/tmp/lmao' WITH (FORMAT CSV, HEADER TRUE);


statement count 3
COPY reversed(id, name) FROM '/tmp/lmao' WITH (FORMAT CSV, HEADER TRUE);


query
SELECT * FROM reversed ORDER BY 1, 2;
----
name	id
babsky	3
pavelvi	2
vedernikoff	1


statement count 3
DELETE FROM reversed;


statement count 3
COPY tindex(name, id) TO '/tmp/lmao';


statement count 3
COPY reversed FROM '/tmp/lmao';


query
SELECT * FROM reversed ORDER BY 1, 2;
----
name	id
babsky	3
pavelvi	2
vedernikoff	1


statement ok
CREATE TABLE varus
(
  id INTEGER,
  name TEXT,
  iq INTEGER DEFAULT 1000 - 7,
  iamdegenereted INTEGER GENERATED ALWAYS AS (iq + id + 228) STORED
);


statement count 3
COPY varus(name, id) FROM '/tmp/lmao';


statement count 3
COPY varus(name, id) FROM '/tmp/lmao';


statement count 3
COPY varus(name, id) FROM '/tmp/lmao';


query
SELECT * FROM varus ORDER BY 1, 2, 3, 4;
----
id	name	iq	iamdegenereted
1	vedernikoff	993	1222
1	vedernikoff	993	1222
1	vedernikoff	993	1222
2	pavelvi	993	1223
2	pavelvi	993	1223
2	pavelvi	993	1223
3	babsky	993	1224
3	babsky	993	1224
3	babsky	993	1224


statement error
COPY varus(iamdegenereted) FROM '/tmp/lmao';
----
db error: ERROR: column "iamdegenereted" is a generated column.
DETAIL: Generated columns cannot be used in COPY.


statement error
COPY varus(name, id) FROM '/tmp/lmao' WITH (LABUDABUDABDAB rick);
----
db error: ERROR: option "labudabudabdab" not recognized


statement count 100000
COPY 
(
  SELECT * 
  FROM 
    generate_series(1, 10) as iq, 
    generate_series(1, 100) as pencil_size, 
    generate_series(1, 100) as weight
) TO '/tmp/arelav' WITH (FORMAT CSV, HEADER 1);


statement ok
CREATE TABLE arelav 
(
  lmao INTEGER,
  kek INTEGER,
  kal INTEGER
);


statement count 100000
COPY arelav FROM '/tmp/arelav' WITH (FORMAT CSV, HEADER 1);


query
SELECT * FROM arelav ORDER BY 1, 2, 3;
----
300003 values hashing to 568009c5b2055554ab4bd827ebe85b75
