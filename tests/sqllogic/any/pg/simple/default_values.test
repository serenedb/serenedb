statement error
CREATE TABLE koshareff(a BOOLEAN DEFAULT 228);
----
db error: ERROR: column "a" is of type boolean but default expression is of type integer
HINT: You will need to rewrite or cast the expression.


statement error
CREATE TABLE vedernikoff(
  yagami TEXT DEFAULT 'saygex' DEFAULT 'saygex'
);
----
db error: ERROR: multiple default values specified for column "yagami" of table "vedernikoff"


statement error
CREATE TABLE vedernikoff(
  yagami TEXT DEFAULT 'saygex' GENERATED ALWAYS AS ('300 bucks') STORED
);
----
db error: ERROR: both default and generation expression specified for column "yagami" of table "vedernikoff"


statement error
CREATE TABLE vedernikoff (
  pencil_size INTEGER GENERATED BY DEFAULT AS (228) STORED
);
----
db error: ERROR: for a generated column, GENERATED ALWAYS must be specified


statement error
CREATE TABLE kil (
  id INTEGER GENERATED ALWAYS AS (1) STORED,
  id2 INTEGER GENERATED ALWAYS AS (id) STORED
);
----
db error: ERROR: cannot use generated column "id" in column generation expression
DETAIL: A generated column cannot reference another generated column.


statement error
CREATE TABLE koshareff(a BOOLEAN, DEFAULT (a = 0));
----
db error: ERROR: syntax error at or near "DEFAULT"


statement ok
CREATE TABLE tindex(
  id INTEGER DEFAULT 228 - 228,
  name TEXT DEFAULT substring('babsky', 1, 5),
  weight INTEGER DEFAULT 1000 - 7,
  pencil_size INTEGER,
  PRIMARY KEY (id)
);

statement error
CREATE TABLE clickclack(
  kal INTEGER DEFAULT ((SELECT * FROM tindex))
);
----
db error: ERROR: cannot use subquery in DEFAULT expression


statement count 1
INSERT INTO tindex DEFAULT VALUES;


statement count 1
INSERT INTO tindex (id, name, weight, pencil_size) VALUES (1, 'vedernikoff', 54, 1);


statement count 1
INSERT INTO tindex (id, pencil_size) VALUES (2, 3);


statement count 1
INSERT INTO tindex (id, name, weight, pencil_size) VALUES (3, DEFAULT, DEFAULT, 1);


statement count 1
INSERT INTO tindex (id, name, weight, pencil_size) VALUES (4, NULL, NULL, NULL);


query
SELECT *, pencil_size IS NULL FROM tindex;
----
id name weight pencil_size ?column?
0 babsk 993 NULL t
1 vedernikoff 54 1 f
2 babsk 993 3 f
3 babsk 993 1 f
4 NULL NULL NULL t


statement ok
UPDATE tindex
SET pencil_size = DEFAULT, weight = DEFAULT;


query
SELECT *, pencil_size IS NULL FROM tindex;
----
id name weight pencil_size ?column?
0 babsk 993 NULL t
1 vedernikoff 993 NULL t
2 babsk 993 NULL t
3 babsk 993 NULL t
4 NULL 993 NULL t


statement error
CREATE TABLE clickclack(
  kal INTEGER GENERATED ALWAYS AS ((SELECT * FROM tindex)) STORED
);


statement error
CREATE TABLE clickclack(
  kal INTEGER GENERATED ALWAYS AS (false) STORED
);
----
db error: ERROR: column "kal" is of type integer but default expression is of type boolean
HINT: You will need to rewrite or cast the expression.


statement ok
CREATE TABLE clickclack(
  id INTEGER PRIMARY KEY DEFAULT 1000,
  weight INTEGER DEFAULT 100,
  age INTEGER DEFAULT 228,
  grade INTEGER GENERATED ALWAYS AS ( (2 * weight + age) / 10 + length('vedro')::integer - 5) STORED
);


statement count 1
INSERT INTO clickclack (id, age) VALUES (0, 18);


statement count 1
INSERT INTO clickclack (id, weight, age) VALUES (1, 130, 54);


statement count 1
INSERT INTO clickclack (id, age, weight) VALUES (2, 130, 54);


statement count 1
INSERT INTO clickclack DEFAULT VALUES;


statement error
INSERT INTO clickclack (id, age, weight, grade) VALUES (228, 1337, 1444, 777);
----
db error: ERROR: cannot insert a non-DEFAULT value into column "grade"
DETAIL: Column "grade" is a generated column.


query
SELECT * FROM clickclack ORDER BY 1, 2, 3, 4;
----
id weight age grade
0 100 18 21
1 130 54 31
2 54 130 23
1000 100 228 42


statement ok
UPDATE clickclack
SET weight = weight * 1000, age = age * 1000
WHERE id = 1000;


statement ok
UPDATE clickclack
SET weight = 22228
WHERE id = 1;


query
SELECT * FROM clickclack ORDER BY 1, 2, 3, 4;
----
id weight age grade
0 100 18 21
1 22228 54 4451
2 54 130 23
1000 100000 228000 42800


statement error
UPDATE clickclack
SET grade = 228
WHERE id = 1000;
----
db error: ERROR: column "grade" can only be updated to DEFAULT
DETAIL: Column "grade" is a generated column.
