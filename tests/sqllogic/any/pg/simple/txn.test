statement ok
CREATE TABLE t(key INT PRIMARY KEY, value INT);


statement ok
BEGIN;


statement ok
INSERT INTO t VALUES (0, 0);


# Read-your-own-writes
# query
# SELECT * FROM t;
# ----
# key	value
# 0	0


statement ok
ROLLBACK;


query
SELECT * FROM t;
----
key	value


statement ok
BEGIN;


statement ok
INSERT INTO t VALUES (0, 0);


statement ok
COMMIT;


query
SELECT * FROM t;
----
key	value
0	0


statement ok
BEGIN;


statement ok
INSERT INTO t VALUES (1, 0);


# Read-your-own-writes
# query
# SELECT * FROM t;
# ----
# key	value
# 0	0
# 1	0


statement ok
ABORT;


query
SELECT * FROM t;
----
key	value
0	0


statement ok
BEGIN;


statement ok
INSERT INTO t VALUES (1, 0);


connection client2
query
SELECT * FROM t;
----
key	value
0	0


statement ok
COMMIT;


connection client2
query
SELECT * FROM t;
----
key	value
0	0
1	0


statement ok
BEGIN;


statement ok
INSERT INTO t VALUES (3, 0);


connection client2
statement ok
BEGIN;


connection client2
query
SELECT * FROM t;
----
key	value
0	0
1	0

connection client2
statement ok
INSERT INTO t VALUES (4, 1);


statement ok
COMMIT;


connection client2
statement ok
COMMIT;


query
SELECT * FROM t;
----
key	value
0	0
1	0
3	0
4	1


connection client2
query
SELECT * FROM t;
----
key	value
0	0
1	0
3	0
4	1


statement count 4
INSERT INTO t SELECT key + 100 as key, value as value FROM t;


query
SELECT * FROM t;
----
key	value
0	0
1	0
3	0
4	1
100	0
101	0
103	0
104	1

# Correct count of affected rows

statement ok
BEGIN;

statement count 1
INSERT INTO t VALUES (105, 0);

statement count 2
INSERT INTO t VALUES (106, 0), (107, 0);

statement count 1
INSERT INTO t VALUES (108, 0);

statement ok
COMMIT;
