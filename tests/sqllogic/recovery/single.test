
# ==== SETUP ====
statement ok
CREATE TABLE IF NOT EXISTS t(key INT PRIMARY KEY, value INT);
RESET sdb_faults;


# ==== BEFORE FAILURE ====
statement ok
BEGIN;


statement ok
INSERT INTO t VALUES (0, 0);


statement ok
COMMIT;


# ==== TRIGGER FAILURE ====
statement ok
SET sdb_fault_crash_on_packet TO DEFAULT;


# Next sent packet will trigger serened crash, so connection will be closed
query error connection closed
SELECT 1;


# ==== TRY TO RECONNECT ====
connection new
query ok retry 10 backoff 500ms
select * from t;
----
key	value
0	0

connection new
statement ok
DROP TABLE IF EXISTS t;
