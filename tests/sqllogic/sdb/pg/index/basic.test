statement ok
CREATE TABLE t(r text);


statement ok
CREATE INDEX index_t ON t USING inverted(r);


statement ok
INSERT INTO t VALUES ('a'), ('b'), ('c')


statement ok
INSERT INTO t VALUES ('a'), ('b'), ('c')


query ok
SELECT * FROM t ORDER BY r;
----
r
a
a
b
b
c
c


statement ok
VACUUM (UPDATE_INDEXES) t;


query ok
SELECT pg_class.relname as indexname FROM pg_index, pg_class WHERE pg_index.indexrelid = pg_class.oid;
----
indexname
index_t


statement ok
DROP INDEX index_t;


query ok
SELECT pg_class.relname as indexname FROM pg_index, pg_class WHERE pg_index.indexrelid = pg_class.oid;
----
indexname


statement ok
INSERT INTO t VALUES ('a'), ('b'), ('c');


statement ok
CREATE INDEX index_t ON t USING inverted(r);


query ok
SELECT pg_class.relname as indexname FROM pg_index, pg_class WHERE pg_index.indexrelid = pg_class.oid;
----
indexname
index_t


statement ok
DROP TABLE t;


query ok
SELECT pg_class.relname as indexname FROM pg_index, pg_class WHERE pg_index.indrelid = pg_class.oid;
----
indexname


statement error db error: ERROR: relation "invalid" does not exist
CREATE INDEX test_index ON invalid USING inverted (invalid);


statement error db error: ERROR: relation "invalid" does not exist
CREATE INDEX test_index ON invalid USING inverted (invalid);


statement ok
CREATE TABLE test(i int);


statement error db error: ERROR: column "invalid" does not exist
CREATE INDEX test_index ON test USING inverted (invalid);


statement ok
CREATE INDEX test_index ON test USING inverted (i);


statement error db error: ERROR: Object already exists: test_index
CREATE INDEX test_index ON test USING inverted (i);


statement ok
CREATE INDEX IF NOT EXISTS test_index ON test USING inverted (i);


query
select oid, relname, relkind FROM pg_class WHERE relname = 'test_index'
----
oid	relname	relkind
<slt:ignore>	test_index	i


query
select indexrelid, indrelid FROM pg_index
----
indexrelid	indrelid
<slt:ignore>	<slt:ignore>


statement ok
DROP INDEX test_index;


statement error db error: ERROR: Index not found: test_index
DROP INDEX test_index;


statement ok
DROP INDEX IF EXISTS test_index;


statement ok
DROP TABLE test;


query ok
SELECT oid, relname, relkind FROM pg_class WHERE relname = 'test_index'
----
oid	relname	relkind


query ok
SELECT indexrelid, indrelid FROM pg_index
----
indexrelid	indrelid

statement ok
CREATE TABLE tstest (a INTEGER, b TIMESTAMP);

statement error db error: ERROR: Column b has unsupported kind and can not be indexed.
CREATE INDEX index_ts on tstest USING inverted(b);

statement ok
DROP TABLE tstest;
