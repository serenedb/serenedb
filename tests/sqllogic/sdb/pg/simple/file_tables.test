hash-threshold 100
control substitution on

statement count 10000
COPY (
  SELECT 
    iq,
    'salary '::text || salary::text || ' dallar'::text as salary, 
    'i do nothing and gain money' as fact
  FROM
    generate_series(1, 100) as clickclack(iq),
    generate_series(1, 100) as serenedb(salary)
) TO '/tmp/${__DATABASE__}_vedernikoff_company.parquet';


statement ok
CREATE TABLE vedernikoff_company(
  iq INT8,
  salary TEXT,
  fact TEXT
) USING EXTERNAL 
WITH (
  PATH = '/tmp/${__DATABASE__}_vedernikoff_company.parquet'
);


# all filters are supposed to be pushdowned â€” no FilterNode in the plan
query ?
EXPLAIN (EXECUTION)
SELECT *
FROM
  vedernikoff_company as v1,
  vedernikoff_company as v2,
  vedernikoff_company as v3
WHERE 
  v1.iq > 90 AND v1.iq < 100 AND v1.iq != 95 AND v1.salary IS NOT NULL
  AND v2.iq = 90 AND v2.salary IS NULL
  AND v3.iq >= 90 AND v3.iq <= 100 AND v3.iq NOT IN (99, 95, 97)
  AND v3.fact LIKE '%gain%' AND (v1.iq = 23 OR v2.iq = 54);
----
QUERY PLAN
EXECUTION PLAN:
Fragment 0:  numWorkers=0:
-- NestedLoopJoin[6][INNER] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR, "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR, "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR
  -- Filter[0][expression: or(presto_eq("iq",23),presto_eq("iq",54))] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR, "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR
    -- NestedLoopJoin[3][INNER] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR, "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR
      -- TableScan[1][File(parquet), [(salary, Filter(IsNotNull, deterministic, no nulls)), (iq, BigintMultiRange: [[91, 94], [96, 99]] no nulls)]] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR
      -- TableScan[2][File(parquet), [(salary, Filter(IsNull, deterministic, with nulls)), (iq, BigintRange: [90, 90] no nulls)]] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR
  -- Filter[5][expression: presto_like("fact",%gain%,\\)] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR
    -- TableScan[4][File(parquet), [(iq, BigintMultiRange: [[90, 94], [96, 96], [98, 98], [100, 100]] no nulls)]] -> "iq":BIGINT, "salary":VARCHAR, "fact":VARCHAR


query
SELECT * FROM vedernikoff_company;
----
30003 values hashing to 017114532d4bd6a929a5d709e1e8d90f


query
SELECT fact, salary FROM vedernikoff_company OFFSET 50 LIMIT 20;
----
fact	salary
i do nothing and gain money	salary 51 dallar
i do nothing and gain money	salary 52 dallar
i do nothing and gain money	salary 53 dallar
i do nothing and gain money	salary 54 dallar
i do nothing and gain money	salary 55 dallar
i do nothing and gain money	salary 56 dallar
i do nothing and gain money	salary 57 dallar
i do nothing and gain money	salary 58 dallar
i do nothing and gain money	salary 59 dallar
i do nothing and gain money	salary 60 dallar
i do nothing and gain money	salary 61 dallar
i do nothing and gain money	salary 62 dallar
i do nothing and gain money	salary 63 dallar
i do nothing and gain money	salary 64 dallar
i do nothing and gain money	salary 65 dallar
i do nothing and gain money	salary 66 dallar
i do nothing and gain money	salary 67 dallar
i do nothing and gain money	salary 68 dallar
i do nothing and gain money	salary 69 dallar
i do nothing and gain money	salary 70 dallar


query
SELECT salary, fact FROM vedernikoff_company ORDER BY 1 DESC LIMIT 1;
----
salary	fact
salary 99 dallar	i do nothing and gain money


query ??????
SELECT *
FROM
  vedernikoff_company as v1,
  vedernikoff_company as v2
WHERE v1.iq > 90 AND v2.iq > 90 AND v1.iq != 98;
----
5400006 values hashing to 497bc5d96ddaa8438d0571265649bb89


query ?
SELECT iq FROM vedernikoff_company WHERE iq = 7 AND salary = 'salary 7 dallar';
----
iq
7


query ??
SELECT salary, iq FROM vedernikoff_company WHERE iq = 7 AND salary = 'salary 7 dallar';
----
salary	iq
salary 7 dallar	7


query ?
SELECT salary FROM vedernikoff_company WHERE iq = 42 AND salary = 'salary 42 dallar';
----
salary
salary 42 dallar


query
SELECT COUNT(iq) FROM vedernikoff_company;
----
count
10000


statement count 10000
COPY (
  SELECT 
    iq,
    'salary '::text || salary::text || ' dallar'::text as salary, 
    'i do nothing and gain money' as fact
  FROM
    generate_series(1, 100) as clickclack(iq),
    generate_series(1, 100) as serenedb(salary)
) TO '/tmp/${__DATABASE__}_vedernikoff_company.csv';


statement ok
CREATE TABLE malandin_company(
  iq INT8,
  salary TEXT,
  fact TEXT
) USING EXTERNAL 
WITH (
  PATH = '/tmp/${__DATABASE__}_vedernikoff_company.csv'
);


query
SELECT salary, iq FROM malandin_company ORDER BY iq, salary LIMIT 1;
----
salary	iq
salary 1 dallar	1


query
SELECT fact FROM malandin_company LIMIT 12;
----
fact
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money
i do nothing and gain money


query
SELECT * FROM malandin_company WHERE iq = 10;
----
303 values hashing to 5600e63d5f8c31d485ae90f71818c6a3


query
SELECT iq FROM malandin_company WHERE iq = 10 LIMIT 1000 - 7;
----
101 values hashing to d205e693a80c0cd10ec6e7a312eaae99


query
SELECT * FROM 
  malandin_company NATURAL JOIN
  vedernikoff_company;
----
30003 values hashing to 017114532d4bd6a929a5d709e1e8d90f
